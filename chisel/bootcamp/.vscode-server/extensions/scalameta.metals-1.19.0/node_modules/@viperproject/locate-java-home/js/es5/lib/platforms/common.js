"use strict";
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.
//
// Copyright (c) 2011-2020 ETH Zurich.
Object.defineProperty(exports, "__esModule", { value: true });
exports.flatten = void 0;
const child_process_1 = require("child_process");
/**
 * Contains helpers providing functionality common to all platforms.
 * In particular the following two options are used:
 * - the JAVA_HOME environment variable
 * - Java on the PATH.
 */
function commonFindJavaHome() {
    return Promise.all([getJavaHomeEnvVar(), getJavaFromPath()])
        .then(flatten);
}
exports.default = commonFindJavaHome;
function getJavaHomeEnvVar() {
    if (process.env.JAVA_HOME) {
        return Promise.resolve([process.env.JAVA_HOME]);
    }
    else {
        return Promise.resolve([]);
    }
}
function getJavaFromPath() {
    return new Promise(resolve => {
        (0, child_process_1.exec)('java -XshowSettings:properties -version', (err, stdout, stderr) => {
            const java_home_line = stderr.toString().trim().split("\n")
                .find((line) => line.indexOf("java.home") != -1);
            if (java_home_line == null) {
                resolve([]);
            }
            else {
                const home = java_home_line.split("=")[1].trim();
                resolve([home]);
            }
        });
    });
}
function flatten(matrix) {
    if (matrix == null) {
        return [];
    }
    return matrix.reduce((prevVal, curVal) => {
        return prevVal.concat(curVal);
    }, []);
}
exports.flatten = flatten;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdHMvbGliL3BsYXRmb3Jtcy9jb21tb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHNFQUFzRTtBQUN0RSxzRUFBc0U7QUFDdEUsMkRBQTJEO0FBQzNELEVBQUU7QUFDRixzQ0FBc0M7OztBQUV0QyxpREFBbUM7QUFFbkM7Ozs7O0dBS0c7QUFDSCxTQUF3QixrQkFBa0I7SUFDeEMsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO1NBQ3pELElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNuQixDQUFDO0FBSEQscUNBR0M7QUFFRCxTQUFTLGlCQUFpQjtJQUN4QixJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFO1FBQ3pCLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBVSxDQUFDLENBQUMsQ0FBQztLQUNsRDtTQUFNO1FBQ0wsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQzVCO0FBQ0gsQ0FBQztBQUVELFNBQVMsZUFBZTtJQUN0QixPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQzNCLElBQUEsb0JBQUksRUFBQyx5Q0FBeUMsRUFBRSxDQUFDLEdBQWlCLEVBQUUsTUFBdUIsRUFBRSxNQUF1QixFQUFFLEVBQUU7WUFDdEgsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7aUJBQ3hELElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25ELElBQUksY0FBYyxJQUFJLElBQUksRUFBRTtnQkFDMUIsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQ2I7aUJBQU07Z0JBQ0wsTUFBTSxJQUFJLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDakQsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUNqQjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBZ0IsT0FBTyxDQUFJLE1BQWE7SUFDdEMsSUFBSSxNQUFNLElBQUksSUFBSSxFQUFFO1FBQ2xCLE9BQU8sRUFBRSxDQUFDO0tBQ1g7SUFDRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFZLEVBQUUsTUFBVyxFQUFFLEVBQUU7UUFDakQsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2hDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUNULENBQUM7QUFQRCwwQkFPQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFRoaXMgU291cmNlIENvZGUgRm9ybSBpcyBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBvZiB0aGUgTW96aWxsYSBQdWJsaWNcbi8vIExpY2Vuc2UsIHYuIDIuMC4gSWYgYSBjb3B5IG9mIHRoZSBNUEwgd2FzIG5vdCBkaXN0cmlidXRlZCB3aXRoIHRoaXNcbi8vIGZpbGUsIFlvdSBjYW4gb2J0YWluIG9uZSBhdCBodHRwOi8vbW96aWxsYS5vcmcvTVBMLzIuMC8uXG4vL1xuLy8gQ29weXJpZ2h0IChjKSAyMDExLTIwMjAgRVRIIFp1cmljaC5cblxuaW1wb3J0IHtleGVjfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcblxuLyoqXG4gKiBDb250YWlucyBoZWxwZXJzIHByb3ZpZGluZyBmdW5jdGlvbmFsaXR5IGNvbW1vbiB0byBhbGwgcGxhdGZvcm1zLlxuICogSW4gcGFydGljdWxhciB0aGUgZm9sbG93aW5nIHR3byBvcHRpb25zIGFyZSB1c2VkOlxuICogLSB0aGUgSkFWQV9IT01FIGVudmlyb25tZW50IHZhcmlhYmxlXG4gKiAtIEphdmEgb24gdGhlIFBBVEguXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNvbW1vbkZpbmRKYXZhSG9tZSgpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gIHJldHVybiBQcm9taXNlLmFsbChbZ2V0SmF2YUhvbWVFbnZWYXIoKSwgZ2V0SmF2YUZyb21QYXRoKCldKVxuICAgIC50aGVuKGZsYXR0ZW4pO1xufVxuXG5mdW5jdGlvbiBnZXRKYXZhSG9tZUVudlZhcigpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gIGlmIChwcm9jZXNzLmVudi5KQVZBX0hPTUUpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtwcm9jZXNzLmVudi5KQVZBX0hPTUUhXSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0SmF2YUZyb21QYXRoKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIGV4ZWMoJ2phdmEgLVhzaG93U2V0dGluZ3M6cHJvcGVydGllcyAtdmVyc2lvbicsIChlcnI6IEVycm9yIHwgbnVsbCwgc3Rkb3V0OiBCdWZmZXIgfCBzdHJpbmcsIHN0ZGVycjogQnVmZmVyIHwgc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBqYXZhX2hvbWVfbGluZSA9IHN0ZGVyci50b1N0cmluZygpLnRyaW0oKS5zcGxpdChcIlxcblwiKVxuICAgICAgICAuZmluZCgobGluZSkgPT4gbGluZS5pbmRleE9mKFwiamF2YS5ob21lXCIpICE9IC0xKTtcbiAgICAgIGlmIChqYXZhX2hvbWVfbGluZSA9PSBudWxsKSB7XG4gICAgICAgIHJlc29sdmUoW10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgaG9tZSA9IGphdmFfaG9tZV9saW5lLnNwbGl0KFwiPVwiKVsxXS50cmltKCk7XG4gICAgICAgIHJlc29sdmUoW2hvbWVdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmbGF0dGVuPFQ+KG1hdHJpeDogVFtdW10pOiBUW10ge1xuICBpZiAobWF0cml4ID09IG51bGwpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIG1hdHJpeC5yZWR1Y2UoKHByZXZWYWw6IFRbXSwgY3VyVmFsOiBUW10pID0+IHtcbiAgICByZXR1cm4gcHJldlZhbC5jb25jYXQoY3VyVmFsKTtcbiAgfSwgW10pO1xufVxuIl19